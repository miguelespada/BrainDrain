
<html> 
 <meta name="tipo_contenido"  content="text/html;" http-equiv="content-type" charset="utf-8">
<head> 
    <script src="lib/jquery-1.8.0.min.js"></script> 
    <script src="lib/jquery.form.js"></script> 
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
 
    <script> 
        var userHasSubmited = false;
        $(document).ready(function() { 

         var options = { 
            target:        '#result',   // target element(s) to be updated with server response 
            beforeSubmit:  prevForm,  // pre-submit callback 
            success:  afterForm  // post-submit callback 
         }; 

         $('#myForm').ajaxForm(options); 
    }); 
 
// pre-submit callback 
function prevForm(formData, jqForm, options) { 

    //(1) Check rest of the form fields.
    //(2) Insert data in the local db
    //(3) Async write in the remote db

    console.log("checking form... ")
    if(userHasSubmited  // Don't allow multiple inserts in the same session 
    || origen.lat == null 
    || origen.lon == null 
    || destino.lat == null 
    || destino.lon == null
    || !origen.inSpain
    || destino.inSpain) return false;


    return true; 
} 
  
function afterForm(responseText, statusText, xhr, $form)  {
    console.log(responseText); 
    userHasSummited = true;
    $('#myForm')

} 

</script> 

</head> 

<body>
<form id="myForm" action="backend/insert.php" method="post"> 
    <ul>
    <li>Origen: <input id="origen" type="text" name="origen" required/> <span id="output1"> </span>
 </li>
    <li>Destino: <input id="destino" type="text" name="destino" required/> <span id="output2"> </span> </li>
    <li>Fecha: <select id="fecha" name="fecha" required>
                    <option value="" selected>
                    <option value="2007">2007
                    <option value="2008">2008
                    <option value="2009">2009
                    <option value="2010">2010
                    <option value="2011">2011
                    <option value="2012">2012
                    <option value="2013">2013
                </select>
    <li>Profesion: <select id="profesion" name="profesion" required>
                    <option value="" selected>
                    <option value="sociales">Ciencias Sociales y Jurídicas: derecho, económicas, empresariales, turismo,...</option>
                    <option value="artes">Artes: Bellas artes, diseño, artes performativas, cine,...</option>
                    <option value="ingenierias">Ingenierías y arquitectura: informática, telecomunicaciones,...</option>
                    <option value="salud">Ciencias de la salud: Medicina, enfermería, veterinaria, psicología,...</option>
                    <option value="humanidades">Humanidades: filosofía, filología, antropología, periodismo,...</option>
                    <option value="ciencias">Ciencias: física, matemáticas, biológicas,...</option>
                    <option value="otras">Otras,...</option>
                   </select>
        <li id = "mensaje"> Mensaje: <input type="text" name="mensaje" /> </li>
    </li>
    <li><input type="submit" value="Submit Comment" /> </li>
    </ul>
    <div id="result"> <div>
</form>
<script>

var origen = {
    target : $('#output1'),
    name : '',
    address : '',
    lat : null,
    lon : null,
    isSpain : null
};

var destino = {
    target : $('#output2'),
    name : '',
    address : '',
    lat : null,
    lon : null,
    isSpain : null
};

var destino 
function showAddress(location, target) {
  var str = "";
  var inSpain = -1;
  if(location == "") return;
  geocoder = new google.maps.Geocoder();
  if (geocoder) {
    geocoder.geocode( { 'address': location, 'region' : 'es'}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        if (status != google.maps.GeocoderStatus.ZERO_RESULTS) {
            var latlng = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng() );
            target.name = location;
            target.address = results[0].formatted_address;
            target.inSpain = results[0].formatted_address.indexOf("Spain") != -1;
            target.lat = parseInt(latlng.lat() * 10);
            target.lon = parseInt(latlng.lng() * 10);
        } else {
          str = "No hay resultados";
        }
      } else {
        str = "Error en geolocalización: " + status;
      }
      target.target.html(target.address)
    });

  }
}
$('#origen').blur(function() {
        showAddress($('#origen').val(), origen);
});
$('#destino').blur(function() {
        showAddress($('#destino').val(), destino);
});
</script>
</body>
</html>